steps:
  # Build the container image
  - name: 'gcr.io/cloud-builders/docker'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        COMMIT_SHA=$COMMIT_SHA
        if [ -z "$COMMIT_SHA" ]; then
          COMMIT_SHA=$BUILD_ID
        fi
        docker build -t gcr.io/$PROJECT_ID/zenapi-app:$COMMIT_SHA .

  # Push the container image to Container Registry
  - name: 'gcr.io/cloud-builders/docker'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        COMMIT_SHA=$COMMIT_SHA
        if [ -z "$COMMIT_SHA" ]; then
          COMMIT_SHA=$BUILD_ID
        fi
        docker push gcr.io/$PROJECT_ID/zenapi-app:$COMMIT_SHA

# Images to be pushed to Container Registry
images:
  - 'gcr.io/$PROJECT_ID/zenapi-app:$COMMIT_SHA'

# Optionally, you can add a timeout
timeout: '1800s'